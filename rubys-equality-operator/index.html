<!doctype html>
      <head>
        <title>Ruby's === equality operator</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width">
        <meta name="description" content="Ruby‚Äôs ```===``` operator is often called the ‚Äòcase equality‚Äô operator, which is indicative of where it is used, but not how it works. I realised I hadn‚Äôt quite grokked the how when I read [Jon Canady&apos;s post](http://joncanady.com/2010/07/05/switching-on-ob‚Ä¶" >
        <link rel="stylesheet" href="/css/normalize.css" type="text/css">
        <link rel="stylesheet" href="/css/style.css" type="text/css">
        <link rel="stylesheet" href="/css/prism-ghcolors.css" type="text/css">
        <link rel="alternate" type="application/rss+xml" title="Subscribe to RSS feed" href="/rss.xml" />
      </head>
      <body class="article">
        <div class="mast">
          <div class='top-bar reading'>
              <div class="links logical">
                <div class="navigation logical">
                  <a href="/">Home</a>
                  <a href="/rss.xml">RSS</a>
                  <a href="/me">
                      Tim Ruffles
                  </a>
                </div>
              </div>
            </div>
        </div>
        <div class="content" class="reading">
           

           <div class="body">
              <h1><a href="/rubys-equality-operator">Ruby's === equality operator</a></h1>
  <p>Ruby‚Äôs <code>===</code> operator is often called the ‚Äòcase equality‚Äô operator, which is indicative of where it is used, but not how it works. I realised I hadn‚Äôt quite grokked the how when I read <a href="http://joncanady.com/2010/07/05/switching-on-object-class-in-ruby/" >Jon Canady&#39;s post</a>.</p>
<p>Jon was confused that the follow switch statement didn‚Äôt work as he‚Äôd expected - it wasn‚Äôt matching even though obj was an instance of ActiveRecord::Base.</p>
<pre><code>case obj<span class="token punctuation">.</span>class
  <span class="token class-name">when</span> ActiveRecord<span class="token punctuation">:</span><span class="token punctuation">:</span>Base
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
end</code></pre>
<p>I knew that this was because <code>obj.class</code> evaluates to <code>ActiveRecord::Base</code>, which is an instance of <code>Class</code>, not of <code>ActiveRecord::Base</code>.</p>
<p>But I realised I didn‚Äôt know the mechanics of how the correct version (simply ‚Äòcase obj‚Äô) worked! Looking in the <a href="http://ruby-doc.org/core/classes/Object.html" >faithful RDocs</a> for , I found that <code>===</code> is normally passed directly to <code>==</code>, which normally checks if two objects have equivalent value. However overriding <code>===</code> is suggested to provide ‚Äúprovide meaningful semantics in case statements‚Äù. So what would these be?</p>
<p>I fired up IRB and had a go. First thing to realise is that in case statements, the receiver of the <code>===</code> operator is the expression in the when clause, not in the case clause. Second is that to remember it‚Äôs therefore being called on a Class object - a class method.</p>
<p>So in Jon‚Äôs correct example, the method call is <code>ActiveRecord::Base.===(obj)</code>. Look at the API docs for ActiveRecord, and you‚Äôll see <code>===</code> returns the result of calling is_a? on the object passed to <code>===</code>, with the receiver of <code>===</code> itself as argument. Thus in Jon‚Äôs incorrect example the value of <code>===</code> would evaluate to the predicate <code>Class.is_a?(ActiveRecord::Base)</code>, which of course it isn‚Äôt, as Class is a superclass of ActiveRecord.</p>
<p>That‚Äôs the common pattern for <code>===</code> AFAIK. As a class method, it‚Äôll normally be equivalent to asking the receiver, ‚Äòis this argument an instance of yourself?‚Äô. As an instance method, it‚Äôll normally be equivalent to ==, value equality.</p>
<p>So a quick demo of <code>===</code> as a class method:</p>
<pre><code><span class="token operator">></span><span class="token operator">></span> String <span class="token operator">===</span> <span class="token string">"a"</span>
<span class="token operator">></span><span class="token operator">></span> <span class="token boolean">true</span> # <span class="token string">"a"</span> is a String
<span class="token operator">></span><span class="token operator">></span> <span class="token string">"a"</span><span class="token punctuation">.</span>is_a<span class="token operator">?</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span>
<span class="token operator">></span><span class="token operator">></span> <span class="token boolean">true</span> # different way of asking the above</code></pre>
<p>and for instance methods, demonstrating it is normally a value comparison, rather than an object comparison:</p>
<pre><code><span class="token operator">></span><span class="token operator">></span> <span class="token string">"a"</span> <span class="token operator">===</span> <span class="token string">"b"</span>
<span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">false</span> # different values<span class="token punctuation">,</span> different objects
<span class="token operator">></span><span class="token operator">></span> <span class="token string">"a"</span> <span class="token operator">===</span> <span class="token string">"a"</span>
<span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">true</span> # same values
<span class="token operator">></span><span class="token operator">></span> <span class="token string">"a"</span><span class="token punctuation">.</span>equal<span class="token operator">?</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span>
<span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">false</span> # different objects
<span class="token operator">></span><span class="token operator">></span> <span class="token punctuation">:</span>a<span class="token punctuation">.</span>equal<span class="token operator">?</span> <span class="token punctuation">:</span>a
<span class="token operator">=</span><span class="token operator">></span> <span class="token boolean">true</span> # same objects</code></pre>

  <div class="article-footer">
  <p class=nav>
    Next: <a href="/rails-3-asset-pipeline-in-a-minute">
      Rails 3 Asset Pipeline in a minute
    </a>
    </p>
  <p class=nav>
    Previous: <a href="/my-first-experiments-with-r">
      My first experiments with R
    </a>
    </p>
        
    </div>
            </div>
        </div>
        <div class="footer reading">
          <div class="container">
            <p>üì© helloÔº†timr ¬∑ co</p>
          </div>
        </div>
      </body><!-- built from 209034c5af198bf433527e59cde69c9ff90518de -->